--- 
layout: post
tags: []

type: post
meta: 
  _encloseme: "1"
published: true
title: 社交游戏框架讨论及其基于Django的方案介绍

status: publish
category: tech
---
<span class="Apple-style-span" style="font-family: 'Times New Roman'; line-height: normal; font-size: medium; "><h1 class="title" style="text-align: center; ">社交游戏框架讨论及其基于Django的方案介绍</h1><p>本博客所有内容采用&nbsp;<a class="reference external" href="http://creativecommons.org/about/licenses/meet-the-licenses" target="_blank">Creative Commons Licenses</a>&nbsp;许可使用. 引用本内容时，请保留&nbsp;<a class="reference external" href="http://sites.google.com/site/towerjoo" target="_blank">朱涛</a>,&nbsp;<a class="reference external" href="http://www.cnblogs.com/mindsbook" target="_blank">出处</a>&nbsp;，并且&nbsp;<strong>非商业</strong>&nbsp;.</p><p>点击&nbsp;<a class="reference external" href="http://feed.feedsky.com/MindsbookTowerJoo" target="_blank">订阅</a>&nbsp;来订阅本博客.(推荐使用&nbsp;<a class="reference external" href="http://reader.google.com/" target="_blank">google reader</a>, 如果你的浏览器不支持直接订阅,请直接在&nbsp;<a class="reference external" href="http://reader.google.com/" target="_blank">google reader</a>&nbsp;中手动添加).</p><p>点击&nbsp;<a class="reference external" href="http://groups.google.com/group/python-share/web/social_game_arch_and_django_based_solution.pdf" target="_blank">下载pdf阅读</a>&nbsp;(如果浏览器不支持直接打开,请点击右键另存)</p><div class="section" id="id1"><h1><a class="toc-backref" href="file:///E:/hg/knowledge/blog-zh/source/django/zhutao.html#id24" style="text-decoration: none; color: black; " target="_blank">摘要</a></h1><p>社交游戏是新出现的一种新型的基于浏览器的游戏形式, 通常具有简单, 易玩, 互动性高等特点.</p><p>本文主要简单介绍了下社交游戏的一些基本知识, 并且探讨了两种不同的架构方式,最后 简单谈了下基于&nbsp;<a class="reference external" href="http://www.djangoproject.com/" target="_blank">Django</a>&nbsp;的社交游戏框架的思路和实现.</p><div class="contents topic" id="contents" style="margin-top: 2em; margin-right: 2em; margin-bottom: 2em; margin-left: 2em; "><p class="topic-title first" style="margin-top: 0px !important; font-weight: bold; ">Contents</p><ul class="simple" style="margin-bottom: 1em; "><li><a class="reference internal" href="file:///E:/hg/knowledge/blog-zh/source/django/zhutao.html#id1" id="id24" target="_blank">摘要</a></li><li><a class="reference internal" href="file:///E:/hg/knowledge/blog-zh/source/django/zhutao.html#id2" id="id25" target="_blank">引入</a></li><li><a class="reference internal" href="file:///E:/hg/knowledge/blog-zh/source/django/zhutao.html#id3" id="id26" target="_blank">背景介绍</a></li><li><a class="reference internal" href="file:///E:/hg/knowledge/blog-zh/source/django/zhutao.html#id4" id="id27" target="_blank">社交游戏的架构</a></li><li><a class="reference internal" href="file:///E:/hg/knowledge/blog-zh/source/django/zhutao.html#flash" id="id28" target="_blank">基于flash的架构方案</a></li><li><a class="reference internal" href="file:///E:/hg/knowledge/blog-zh/source/django/zhutao.html#javascript" id="id29" target="_blank">基于javascript的架构方案</a></li><li><a class="reference internal" href="file:///E:/hg/knowledge/blog-zh/source/django/zhutao.html#id5" id="id30" target="_blank">两种方案的比较</a><ul><li><a class="reference internal" href="file:///E:/hg/knowledge/blog-zh/source/django/zhutao.html#id6" id="id31" target="_blank">用户体验方面</a></li><li><a class="reference internal" href="file:///E:/hg/knowledge/blog-zh/source/django/zhutao.html#id7" id="id32" target="_blank">技术层面</a></li><li><a class="reference internal" href="file:///E:/hg/knowledge/blog-zh/source/django/zhutao.html#id8" id="id33" target="_blank">人力资源</a></li></ul></li><li><a class="reference internal" href="file:///E:/hg/knowledge/blog-zh/source/django/zhutao.html#id9" id="id34" target="_blank">关于Django的后台方案</a></li><li><a class="reference internal" href="file:///E:/hg/knowledge/blog-zh/source/django/zhutao.html#id10" id="id35" target="_blank">结论</a></li><li><a class="reference internal" href="file:///E:/hg/knowledge/blog-zh/source/django/zhutao.html#id11" id="id36" target="_blank">后记</a></li><li><a class="reference internal" href="file:///E:/hg/knowledge/blog-zh/source/django/zhutao.html#id12" id="id37" target="_blank">参考资料</a></li><li><a class="reference internal" href="file:///E:/hg/knowledge/blog-zh/source/django/zhutao.html#rst" id="id38" target="_blank">本文的rst源码</a></li></ul></div></div><div class="section" id="id2"><h1><a class="toc-backref" href="file:///E:/hg/knowledge/blog-zh/source/django/zhutao.html#id25" style="text-decoration: none; color: black; " target="_blank">引入</a></h1><p>"今天你偷菜了吗?" 当这句话成为隔壁大妈每日的口头禅时, 你就能够设想出来这款游戏的火爆程度.</p><p>自从&lt;&lt;开心农场&gt;&gt;开始风靡中国的&nbsp;<a class="reference external" href="http://www.kaixin001.com/" target="_blank">开心网</a>&nbsp;,&nbsp;<a class="reference external" href="http://www.renren.com/" target="_blank">人人网</a>&nbsp;,&nbsp;<a class="reference external" href="http://www.qq.com/" target="_blank">QQ</a>&nbsp;时,&nbsp;<a class="reference external" href="http://www.fminutes.com/" target="_blank">五分钟</a>&nbsp;(开心农场的开发公司)也在&nbsp;<a class="reference external" href="http://www.facebook.com/" target="_blank">facebook</a>&nbsp;上取得了一定的成就.</p><p>近期我也踏上了&nbsp;<a class="reference external" href="http://www.socialtimes.com/2008/07/social-games/" target="_blank">social game</a>&nbsp;的这个行业, 并在游戏的架构方面做了一定的工作, 这篇博文会在大的层面 和大家探讨下&nbsp;<a class="reference external" href="http://www.socialtimes.com/2008/07/social-games/" target="_blank">social game</a>&nbsp;游戏的架构设计(本文不会细节到出现商业机密泄露的程度, 请不要向我索取 游戏框架的源代码.)</p></div><div class="section" id="id3"><h1><a class="toc-backref" href="file:///E:/hg/knowledge/blog-zh/source/django/zhutao.html#id26" style="text-decoration: none; color: black; " target="_blank">背景介绍</a></h1><p>什么是社交游戏? 这是我们首要了解的问题. 我给出的定义是: 社交游戏是基于社交平台(&nbsp;<a class="reference external" href="http://www.facebook.com/" target="_blank">facebook</a>&nbsp;,&nbsp;<a class="reference external" href="http://www.renren.com/" target="_blank">人人网</a>&nbsp;) 的相关资源(好友关系等)之上建立起的以用户互动为基础, 以购买道具或者植入广告为赢利模式的 网页游戏.</p><p>从全球的行业来看, 世界上的巨头有&nbsp;<a class="reference external" href="http://en.wikipedia.org/wiki/Playfish" target="_blank">playfish</a>,&nbsp;<a class="reference external" href="http://en.wikipedia.org/wiki/Zynga" target="_blank">zynga</a>, 中国的开拓者有&nbsp;<a class="reference external" href="http://www.fminutes.com/" target="_blank">五分钟</a>&nbsp;等.</p><p>社交游戏是最早出现在&nbsp;<a class="reference external" href="http://www.facebook.com/" target="_blank">facebook</a>&nbsp;,&nbsp;<a class="reference external" href="http://myspace.com/" target="_blank">myspace</a>&nbsp;这样的SNS网站上作为独立或者由网站自己开发的小型游戏(相比 于传统网游), 到今年&nbsp;<a class="reference external" href="http://www.fminutes.com/" target="_blank">五分钟</a>&nbsp;成功地将开心农场做到极致, 社交游戏才为中国的网民所熟知.</p><p>如果你了解&nbsp;<a class="reference external" href="http://en.wikipedia.org/wiki/Electronic_Arts" target="_blank">EA</a>&nbsp;花了多少钱收购了&nbsp;<a class="reference external" href="http://en.wikipedia.org/wiki/Playfish" target="_blank">playfish</a>&nbsp;, 也了解&nbsp;<a class="reference external" href="http://en.wikipedia.org/wiki/Zynga" target="_blank">zynga</a>&nbsp;和&nbsp;<a class="reference external" href="http://www.fminutes.com/" target="_blank">五分钟</a>&nbsp;的季度收入, 你就会知道目前这个市场有 多大.不妨去google下吧.</p><p>与传统网游相比, 社交游戏有如下几个特点:</p><ol class="arabic simple" style="margin-bottom: 1em; list-style-type: decimal; list-style-position: initial; list-style-image: initial; "><li>用户互动性高</li><li>用户归属感强(通常是自己圈子里的好友)</li><li>用户沉溺的可能性较小(当然更多取决于个人)</li><li>准入门槛较低(不需要太多的烧钱)</li><li>平台分成很高(像&nbsp;<a class="reference external" href="http://www.facebook.com/" target="_blank">facebook</a>&nbsp;,&nbsp;<a class="reference external" href="http://myspace.com/" target="_blank">myspace</a>&nbsp;,&nbsp;<a class="reference external" href="http://www.renren.com/" target="_blank">人人网</a>&nbsp;的分成会占到整个游戏收入的很大一部分)</li><li>迭代开发周期短(更好地响应用户的需求)</li></ol><p>了解了社交游戏的基本的知识,我们来看本文的重点: 社交游戏的架构.</p></div><div class="section" id="id4"><h1><a class="toc-backref" href="file:///E:/hg/knowledge/blog-zh/source/django/zhutao.html#id27" style="text-decoration: none; color: black; " target="_blank">社交游戏的架构</a></h1><p>因为社交游戏是内建于sns平台的一种应用,所以,它需要依赖于整个sns平台, 会调用sns平台的API, 整体架构如下:</p><img alt="http://farm3.static.flickr.com/2500/4181865986_fa4eb0291c_o.jpg" src="http://farm3.static.flickr.com/2500/4181865986_fa4eb0291c_o.jpg" /><p>上面架构图是基于&nbsp;<a class="reference external" href="http://www.facebook.com/" target="_blank">facebook</a>&nbsp;的,&nbsp;<a class="reference external" href="http://www.renren.com/" target="_blank">人人网</a>&nbsp;与&nbsp;<a class="reference external" href="http://www.facebook.com/" target="_blank">facebook</a>&nbsp;的架构完全相同(基本上是完全拷贝).</p><p>下面的讨论中会主要集中在上图Your Server这个模块的架构, 与sns平台的接口的通信可以参考特定 平台的相关文档.</p><p>另外社交游戏是一种网页游戏, 所以它具有网页游戏架构的所有特征.</p><p>通常社交游戏有两种技术方案, 一种是前端基于flash, 一种是前端基于javascript, 后端可以任意选择 技术方案, 如PHP, java,&nbsp;<a class="reference external" href="http://www.python.org/" target="_blank">Python</a>&nbsp;等.</p><p>从目前来看, 基于flash的架构方案因为其良好的用户UI和较好的用户响应在整个市场上占据更多的 份额,如&lt;&lt;开心农场&gt;&gt;等. 但是因为flash容易被破解, 所以通常很容易会被后续公司所克隆.</p><p>下面我们主要分别介绍两种主流的架构方案, 以及以&nbsp;<a class="reference external" href="http://www.python.org/" target="_blank">Python</a>&nbsp;/&nbsp;<a class="reference external" href="http://www.djangoproject.com/" target="_blank">Django</a>&nbsp;作为后端的实现方案.</p></div><div class="section" id="flash"><h1><a class="toc-backref" href="file:///E:/hg/knowledge/blog-zh/source/django/zhutao.html#id28" style="text-decoration: none; color: black; " target="_blank">基于flash的架构方案</a></h1><img alt="http://farm3.static.flickr.com/2749/4181705394_746548aee4_o.png" src="http://farm3.static.flickr.com/2749/4181705394_746548aee4_o.png" /><p>此架构方案比较重要的一块是&nbsp;<a class="reference external" href="http://en.wikipedia.org/wiki/Action_Message_Format" target="_blank">AMF</a>&nbsp;, 这是flash的一种通信协议(二进制), 主流的后端语言都对这种 协议有支持,如&nbsp;<a class="reference external" href="http://pyamf.org/" target="_blank">pyamf</a>&nbsp;(for&nbsp;<a class="reference external" href="http://www.python.org/" target="_blank">Python</a>&nbsp;),&nbsp;<a class="reference external" href="http://www.amfphp.org/" target="_blank">AMFPHP</a>&nbsp;(for php)等等.</p><p>而&nbsp;<a class="reference external" href="http://en.wikipedia.org/wiki/Action_Message_Format" target="_blank">AMF</a>&nbsp;是一种RPC的调用, 后面提到的基于javascript的方案可以认为是REST的方式, RPC和REST的差别 可以参考&nbsp;<a class="reference external" href="http://www.cnblogs.com/mindsbook/archive/2009/11/17/web_service_RESTvsRPC.htmlttp://www.cnblogs.com/mindsbook/archive/2009/11/17/web_service_RESTvsRPC.html" target="_blank">Web Service实践之REST vs RPC</a>.</p><p>这种方案需要重点强调的是关于flash通信加密的问题, 记得不久之前园子里有人写过开心农场的外挂. 所以 安全性是很重要的一块内容.</p><p>可以参考的文档有:</p><ol class="arabic simple" style="margin-bottom: 1em; list-style-type: decimal; list-style-position: initial; list-style-image: initial; "><li><a class="reference external" href="http://huaidan.org/archives/3396.html" target="_blank">Flash应用安全规范</a></li><li><a class="reference external" href="http://huaidan.org/archives/3277.html" target="_blank">How To Decompile Actionscript Code In Swf</a>&nbsp;(了解下如何被别人反编译也是预防基础)</li><li><a class="reference external" href="http://huaidan.org/archives/3328.html" target="_blank">关于flash封装JS代码的一些TIPS</a></li></ol></div><div class="section" id="javascript"><h1><a class="toc-backref" href="file:///E:/hg/knowledge/blog-zh/source/django/zhutao.html#id29" style="text-decoration: none; color: black; " target="_blank">基于javascript的架构方案</a></h1><img alt="http://farm3.static.flickr.com/2518/4180942191_ed170cd55c_o.png" src="http://farm3.static.flickr.com/2518/4180942191_ed170cd55c_o.png" /><p>相比于基于flash的架构方案,这种方式最大的不同是前端与后端的通信使用的是ajax/json的方式, 每次通信都是异步地使用ajax来调用后端的RESTful的URI, 并且使用json作为通信交互数据格式.</p><p>这里面需要注意的几个问题是:</p><ol class="arabic simple" style="margin-bottom: 1em; list-style-type: decimal; list-style-position: initial; list-style-image: initial; "><li>安全性(来自前端的请求都是需要在后端验证的)</li><li>性能(优化ajax请求,对于静态的内容只请求一次)</li><li>lazy loading(尽量将请求后置, 只有当用户真正请求时才去load)</li></ol><p>基于javascript的方案可以认为是REST的方式, RPC和REST的差别可以参考&nbsp;<a class="reference external" href="http://www.cnblogs.com/mindsbook/archive/2009/11/17/web_service_RESTvsRPC.htmlttp://www.cnblogs.com/mindsbook/archive/2009/11/17/web_service_RESTvsRPC.html" target="_blank">Web Service实践之REST vs RPC</a>.</p></div><div class="section" id="id5"><h1><a class="toc-backref" href="file:///E:/hg/knowledge/blog-zh/source/django/zhutao.html#id30" style="text-decoration: none; color: black; " target="_blank">两种方案的比较</a></h1><div class="section" id="id6"><h2><a class="toc-backref" href="file:///E:/hg/knowledge/blog-zh/source/django/zhutao.html#id31" style="text-decoration: none; color: black; " target="_blank">用户体验方面</a></h2><p>目前我们的项目同时有两种方案的产品在研发之中, 相比而言, 对于一个新立项的项目, 我更倾向于使用flash, 因为 无论是从用户体验等各个方面,它都有更好的表现, 而且这种简单易操作的界面通常能够更加赢得用户的青睐.</p><p>但是通常第一次的load时间会比较久(或者可以称其为pre-load的一种思路).</p></div><div class="section" id="id7"><h2><a class="toc-backref" href="file:///E:/hg/knowledge/blog-zh/source/django/zhutao.html#id32" style="text-decoration: none; color: black; " target="_blank">技术层面</a></h2><p>但是如果单就技术层面而言,我更加倾向于使用javascript的方式, 基于REST的架构在扩展性方面会有 更多优势.</p></div><div class="section" id="id8"><h2><a class="toc-backref" href="file:///E:/hg/knowledge/blog-zh/source/django/zhutao.html#id33" style="text-decoration: none; color: black; " target="_blank">人力资源</a></h2><p>相比于javascript程序员, 一个优秀的flash程序员更加稀缺, 所以在开发团队方面 也会有一定的折中.</p><p>其它诸如部署, 开发成本核算等方面,也应该有更多的权衡.</p></div></div><div class="section" id="id9"><h1><a class="toc-backref" href="file:///E:/hg/knowledge/blog-zh/source/django/zhutao.html#id34" style="text-decoration: none; color: black; " target="_blank">关于Django的后台方案</a></h1><p>最后我再谈谈,基于&nbsp;<a class="reference external" href="http://www.djangoproject.com/" target="_blank">Django</a>&nbsp;的后台解决方案.</p><dl class="docutils"><dt>目前, 我所知道的使用&nbsp;<a class="reference external" href="http://www.djangoproject.com/" target="_blank">Django</a>&nbsp;来作为后台解决方案的产品包括:&nbsp;<a class="reference external" href="http://www.renren.com/" target="_blank">人人网</a>&nbsp;上的&nbsp;<a class="reference external" href="http://apps.renren.com/paopaoyu/" target="_blank">泡泡鱼</a>&nbsp;,</dt><dd style="margin-bottom: 0.5em; "><a class="reference external" href="http://www.fminutes.com/" target="_blank">五分钟</a>&nbsp;的部分产品(参考他们的&nbsp;<a href="http://groups.google.com/group/python-cn/msg/b0fb84a46d914901" target="_blank">招聘帖</a>)等.</dd></dl><p>使用&nbsp;<a class="reference external" href="http://www.djangoproject.com/" target="_blank">Django</a>&nbsp;作为后台的方案有如下的好处:</p><ol class="arabic simple" style="margin-bottom: 1em; list-style-type: decimal; list-style-position: initial; list-style-image: initial; "><li><a class="reference external" href="http://www.python.org/" target="_blank">Python</a>&nbsp;本身的优秀</li><li>敏捷开发(通常是将&nbsp;<a class="reference external" href="http://www.djangoproject.com/" target="_blank">Django</a>&nbsp;和RoR作为敏捷开发的典范框架)</li><li>清晰的框架</li><li>资源(社区,第三方插件等等)</li></ol><p>基于&nbsp;<a class="reference external" href="http://www.djangoproject.com/" target="_blank">Django</a>&nbsp;简单地进行一些封装,使其更加适合社交游戏的开发, 如何封装, 就看个人的 经验和能力了. 祝好运!</p></div><div class="section" id="id10"><h1><a class="toc-backref" href="file:///E:/hg/knowledge/blog-zh/source/django/zhutao.html#id35" style="text-decoration: none; color: black; " target="_blank">结论</a></h1><p>文中没有提到一些比较隐私的数据,当然这些数据你也能够从某些途径获取(如收入, 和平台的 分成比例等), 也没有谈具体的架构细节(我希望某一天可以开源和大家分享), 但是整体的架构思路应该还是很清楚的.</p><p>作为一个优秀的社交游戏产品,无论&nbsp;<strong>前期的游戏策划</strong>&nbsp;,&nbsp;<strong>中期的游戏开发</strong>, 和&nbsp;<strong>后期的游戏推广</strong>&nbsp;,各个环节的 成功才能铸就一个成功的游戏.</p><p>当别人问你"今天你偷菜了吗?", 我则想问 "今天你了解social game吗?"</p><p>期待和朋友们交流.</p></div><div class="section" id="id11"><h1><a class="toc-backref" href="file:///E:/hg/knowledge/blog-zh/source/django/zhutao.html#id36" style="text-decoration: none; color: black; " target="_blank">后记</a></h1><p>后面可能还会谈一些关于社交游戏安全性的一些内容, 所谓&nbsp;<strong>防人之心不可无, 害人之心不可有</strong>, 防范的工作还是要做好的.</p></div><div class="section" id="id12"><h1><a class="toc-backref" href="file:///E:/hg/knowledge/blog-zh/source/django/zhutao.html#id37" style="text-decoration: none; color: black; " target="_blank">参考资料</a></h1><ol class="arabic simple" style="margin-bottom: 1em; list-style-type: decimal; list-style-position: initial; list-style-image: initial; "><li><a class="reference external" href="http://www.cnblogs.com/mindsbook/archive/2009/11/17/web_service_RESTvsRPC.htmlttp://www.cnblogs.com/mindsbook/archive/2009/11/17/web_service_RESTvsRPC.html" target="_blank">Web Service实践之REST vs RPC</a></li><li><a class="reference external" href="http://pyamf.org/" target="_blank">pyamf</a></li><li><a class="reference external" href="http://www.djangoproject.com/" target="_blank">Django</a></li><li><a class="reference external" href="http://www.python.org/" target="_blank">Python</a></li><li><a class="reference external" href="http://www.insidesocialgames.com/" target="_blank">insidesocialgames.com</a></li></ol></div><div class="section" id="rst"><h1><a class="toc-backref" href="file:///E:/hg/knowledge/blog-zh/source/django/zhutao.html#id38" style="text-decoration: none; color: black; " target="_blank">本文的rst源码</a></h1><p>本文的源码链接在&nbsp;<a class="reference external" href="http://groups.google.com/group/python-share/web/social_game_framework.rst" target="_blank">这里</a>&nbsp;.</p><p>点击&nbsp;<a class="reference external" href="http://groups.google.com/group/python-share/web/social_game_arch_and_django_based_solution.pdf" target="_blank">下载pdf阅读</a>&nbsp;(如果浏览器不支持直接打开,请点击右键另存)</p></div></span>
