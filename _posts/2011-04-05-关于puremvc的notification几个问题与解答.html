--- 
layout: post
title: å…³äºpureMVCçš„notificationå‡ ä¸ªé—®é¢˜ä¸è§
  o+etlA==

published: true
meta: 
  _encloseme: "1"
  _edit_last: "14125"
  _edit_lock: "1301989469"
  _pingme: "1"
tags: 
- æŠ€æœ¯

- actionscript
- puremvc
- æ€»ç»“

type: post
status: publish
category: tech
---
å› ä¸ºå·¥ä½œéœ€è¦,æœ€è¿‘ä¹Ÿå¼€å§‹å­¦ä¹ å’Œä½¿ç”¨Â <a class="reference external" href="http://puremvc.org/">pureMVC</a> , ä¹‹å‰ä¹Ÿå†™è¿‡ä¸€ä¸ªÂ <a class="reference external" href="http://towerjoo.blog.techweb.com.cn/archives/142.html">pureMVC Hello Worldæ•™ç¨‹</a>, ç®—æ˜¯å¼€å§‹å…¥é—¨è¿™ä¸ªæ¡†æ¶å’ŒASè¿™ç§è¯­è¨€.ç»è¿‡ä¸¤å‘¨å¤šçš„å­¦ä¹ å’Œä½¿ç”¨,ç”Ÿå‡ºäº†å‡ ä¸ªç–‘é—®, å’Œå…¬å¸çš„åšASçš„åŒäº‹ æ²Ÿé€šæ—¶,å‘è§‰ä»–ä¹Ÿå¹¶ä¸èƒ½æ¸…æ¥šåœ°è¯´å‡ºæ‰€ä»¥ç„¶æ¥,æ‰€ä»¥å†³å®šè‡ªè¡Œç ”ç©¶è¿™äº›é—®é¢˜,å¹¶å°è¯•ç»™å‡ºè§£ç­”.

é—®é¢˜å¤§è‡´æœ‰ä¸‹é¢å‡ ä¸ª:
<ol class="arabic simple">
	<li>å¦‚æœä¸€ä¸ªnotificationæœ‰å¤šä¸ªè®¢é˜…è€…,é‚£ä¹ˆè¿™å¤šä¸ªè®¢é˜…è€…ä¹‹å‰çš„æ‰§è¡Œé¡ºåºæ˜¯æ€ä¹ˆæ ·çš„?</li>
	<li>ä¸€æ®µä»£ç åœ¨æ‰§è¡Œæ—¶,å¦‚æœå‘å‡ºä¸€ä¸ªnotification,æ˜¯ç­‰å¾…ç›¸åº”çš„notificationè®¢é˜…è€…å¤„ç†ç»“æŸå†ç»§ç»­å‘¢,è¿˜æ˜¯ ç›´æ¥ç»§ç»­,ç›¸åº”çš„notificationè®¢é˜…è€…å¼‚æ­¥åœ°æ‰§è¡Œ?</li>
	<li>ä¸€ä¸ªnotificationçš„å¤šä¸ªè®¢é˜…è€…ä¹‹é—´çš„æ‰§è¡Œæ˜¯å¼‚æ­¥çš„,è¿˜æ˜¯é¡ºåºæ‰§è¡Œçš„?</li>
	<li>æ˜¯å¦å¯èƒ½å‡ºç°notificationæ­»å¾ªç¯çš„é—®é¢˜? (å³notification Açš„è®¢é˜…è€…Xå‘å‡ºnotification B,Bçš„è®¢é˜…è€… åˆå‘å‡ºnotification A,å½¢æˆä¸€ä¸ªæ²¡æœ‰å‡ºå£çš„å¾ªç¯)</li>
</ol>
<a href="/assets/images/notification.jpg"><img class="alignnone size-medium wp-image-160" src="/assets/images/notification.jpg" alt="" width="300" height="228" /></a>
<div id="id1" class="section">
<h1>ç ”ç©¶å’Œè§£å†³ä¸Šè¿°é—®é¢˜</h1>
ä¸ºäº†å‡†ç¡®ç ”ç©¶å‡ºä¸Šè¿°çš„é—®é¢˜å’Œç­”æ¡ˆ,æˆ‘é‡‡ç”¨çš„æ–¹æ³•åŒ…æ‹¬ä¸¤ç§: å®éªŒå’Œæºä»£ç é˜…è¯»(å…¶å®åªè¦é˜…è¯»æºä»£ç å³å¯).
<div id="id2" class="section">
<h2>å®éªŒ</h2>
ç›¸å…³çš„ä»£ç å¯ä»Â <a class="reference external" href="https://github.com/topman/blog_code/tree/master/TestPureMVC">TestPureMVC</a> ä¸‹è½½.

è¿™ä¸ªç¨‹åºä¸»è¦æ˜¯å¦‚ä¸‹çš„æµç¨‹:

Startup -&gt; StartUpCommand -&gt; registerMediator(AMediator, BMediator, CMediator) -&gt; sendNotification(Test) -&gt; CMediator(Test) -&gt; sendNotification(Second) -&gt;CMediator(Second) -&gt;sendNotification(Test)

ä»è€Œå½¢æˆäº†ä¸€ä¸ªå¾ªç¯,å¦å¤–,ä¹Ÿå¯ç®€å•åœ°åœ¨StartUpCommandç±»ä¸­æ›´æ”¹æ¥æµ‹è¯•å…¶å®ƒçš„æƒ…å†µ.

ä»ä»£ç ä¸­èƒ½å¤Ÿè¯´æ˜(å¯¹åº”äºæœ¬æ–‡æœ€åˆçš„4ä¸ªé—®é¢˜):
<ol class="arabic simple">
	<li>notificationçš„å¤šä¸ªè®¢é˜…è€…çš„æ‰§è¡Œé¡ºåºæ˜¯æŒ‰ç…§å…¶æ³¨å†Œçš„é¡ºåºæ‰§è¡Œçš„,ä¹Ÿå°±æ˜¯å…¨å±€çš„viewä¸­ç»´æŠ¤çš„mediatoræ•°ç»„ä¸­çš„é¡ºåº</li>
	<li>å› ä¸ºASä¸­æ²¡æœ‰ç±»ä¼¼äºsleepçš„æ–¹æ³•,æ‰€ä»¥æ— æ³•ç¡®å®š2(å…·ä½“ç»“æœå‚è€ƒä¸‹æ–‡,ä»£ç åˆ†æéƒ¨åˆ†)</li>
	<li>åŒ2</li>
	<li>ä¼šå‡ºç°æ­»å¾ªç¯,æœ€ç»ˆä¼šå‡ºç°æ ˆæº¢å‡ºçš„é”™è¯¯</li>
</ol>
</div>
<div id="id3" class="section">
<h2>æºä»£ç åˆ†æ</h2>
å› ä¸ºCommandå’ŒMediatoréƒ½å¯ä»¥å¤„ç†å’Œå‘é€notification,æ‰€ä»¥è¿™é‡Œåªä»¥Mediatorçš„å¤„ç†ä¸ºä¾‹æ¥è¯´æ˜.

æˆ‘ä»¬å…ˆçœ‹notificationæ˜¯å¦‚ä½•é€šçŸ¥çš„:
<pre>// org.puremvc.as3.core.Views.as
public function notifyObservers( notification:INotification ) : void
{
    if( observerMap[ notification.getName() ] != null ) {

        // Get a reference to the observers list for this notification name
        // è·å¾—è¿™ä¸ªnotificationçš„æ‰€æœ‰è®¢é˜…è€…æ•°ç»„
        var observers_ref:Array = observerMap[ notification.getName() ] as Array;

        // Copy observers from reference array to working array,
        // since the reference array may change during the notification loop
        //  notificationçš„å¾ªç¯ä¸­å¯èƒ½å¢åŠ æ–°çš„è®¢é˜…è€…,æ‰€ä»¥è¿™é‡Œæ·±åº¦æ‹·è´ä¸€ä»½
        // æ³¨æ„é¡ºåºå¹¶æ²¡æœ‰æ›´æ”¹
        var observers:Array = new Array();
        var observer:IObserver;
        for (var i:Number = 0; i &lt; observers_ref.length; i++) {
            observer = observers_ref[ i ] as IObserver;
            observers.push( observer );
        }

        // Notify Observers from the working array
        // æ ¹æ®æ•°ç»„ä¸­çš„é¡ºåºä¾æ¬¡æ¥é€šçŸ¥ç›¸åº”çš„è®¢é˜…è€…
        // æ³¨æ„è¿™é‡Œæ˜¯é¡ºåºæ‰§è¡Œçš„
        for (i = 0; i &lt; observers.length; i++) {
            observer = observers[ i ] as IObserver;
            observer.notifyObserver( notification );
        }
    }
}</pre>
æ¥ç€æ¥çœ‹äº‹ä»¶æ˜¯å¦‚ä½•æ³¨å†Œçš„,ä»è€Œå½¢æˆè®¢é˜…è€…çš„æ•°ç»„:
<pre>// org.puremvc.as3.core.Views.as
public function registerMediator( mediator:IMediator ) : void
{
    // do not allow re-registration (you must to removeMediator fist)
    if ( mediatorMap[ mediator.getMediatorName() ] != null ) return;

    // Register the Mediator for retrieval by name
    mediatorMap[ mediator.getMediatorName() ] = mediator;

    // Get Notification interests, if any.
    var interests:Array = mediator.listNotificationInterests();

    // Register Mediator as an observer for each of its notification interests
    if ( interests.length &gt; 0 )
    {
        // Create Observer referencing this mediator's handlNotification method
        var observer:Observer = new Observer( mediator.handleNotification, mediator );

        // Register Mediator as Observer for its list of Notification interests
        for ( var i:Number=0;  i&lt;interests.length; i++ ) {
            // æ³¨æ„: è¿™é‡Œæ˜¯æ ¹æ®Mediatoræœ‰å…´è¶£çš„notificationæ¥åˆ†åˆ«åŠ å…¥åˆ°å¯¹åº”çš„è®¢é˜…è€…æ•°ç»„ä¸­
            // è€ŒåŠ å…¥çš„æ¬¡åºæ­£å¥½æ˜¯æ ¹æ®è¿™ä¸ªMediatorçš„æ³¨å†Œé¡ºåº
            registerObserver( interests[i],  observer );
        }
    }

    // alert the mediator that it has been registered
    mediator.onRegister();

}

// registerObserverçš„å…·ä½“å®ç°
public function registerObserver ( notificationName:String, observer:IObserver ) : void
{
    var observers:Array = observerMap[ notificationName ];
    if( observers ) {
        // é¡ºåºåŠ å…¥åˆ°å¯¹åº”çš„è®¢é˜…è€…æ•°ç»„ä¸­
        observers.push( observer );
    } else {
        observerMap[ notificationName ] = [ observer ];
    }
}</pre>
æˆ‘ä»¬å†çœ‹é€šçŸ¥ç»™è®¢é˜…è€…æ—¶çš„å¤„ç†é€»è¾‘:
<pre>public function notifyObserver( notification:INotification ):void
{
    // æ ¹æ®notificationä¼ è¿‡æ¥çš„ä¸Šä¸‹æ–‡æ¥æ‰§è¡Œç›¸åº”çš„å¤„ç†é€»è¾‘
    this.getNotifyMethod().apply(this.getNotifyContext(),[notification]);
}</pre>
åˆ°æ­¤,ä»æˆ‘ä»¬å¯¹æºä»£ç çš„åˆ†æä¸Š,æˆ‘ä»¬å°±å¯ä»¥å®Œæ•´çš„å›ç­”æœ¬æ–‡åˆå§‹çš„4ä¸ªé—®é¢˜:
<ol class="arabic simple">
	<li>å¦‚æœä¸€ä¸ªnotificationæœ‰å¤šä¸ªè®¢é˜…è€…,é‚£ä¹ˆå¤šä¸ªè®¢é˜…è€…ä¹‹é—´æ˜¯æŒ‰ç…§æ³¨å†Œçš„é¡ºåºæ¥æ‰§è¡Œçš„</li>
	<li>åœ¨ASä¸­ä¸å­˜åœ¨å¼‚æ­¥çš„æ‰§è¡Œ,æ‰€ä»¥,å½“å‰çš„ä»£ç çš„æ‰§è¡Œä¼šç­‰å¾…æ‰€æœ‰çš„notificationæŒ‰ç…§1ä¸­ çš„é¡ºåºæ‰§è¡Œå®Œæˆå,æ‰å¼€å§‹ç»§ç»­æ‰§è¡Œå½“å‰çš„ä»£ç (ç›¸å½“äºè°ƒç”¨ä¸€ä¸ªå‡½æ•°)</li>
	<li>ä¸€ä¸ªnotificationçš„å¤šä¸ªè®¢é˜…è€…ä¹‹é—´æ˜¯é¡ºåºæ‰§è¡Œçš„,é¡ºåºæ˜¯æŒ‰ç…§1ä¸­çš„è¯´æ˜</li>
	<li>å­˜åœ¨æ­»å¾ªç¯çš„å¯èƒ½,å› ä¸ºå¦‚2ä¸­è¯´æ˜,sendNotificationç›¸å½“äºæ ¹æ®æ³¨å†Œçš„é¡ºåºæ¥é¡ºåºæ‰§è¡Œ ç›¸åº”çš„å¤„ç†é€»è¾‘,å¦‚æœåœ¨å¤„ç†é€»è¾‘ä¸­åˆåŒ…å«è§¦å‘sendNotificationçš„äº‹ä»¶,åˆ™æ•´ä¸ªæ‰§è¡Œ ä¼šæˆä¸ºä¸€ä¸ªæ­»å¾ªç¯,ä»è€Œå¯¼è‡´æ ˆæº¢å‡º</li>
</ol>
</div>
</div>
<div id="id4" class="section">
<h1>æ€»ç»“</h1>
é€šè¿‡å¯¹æœ¬æ–‡å¼€å§‹4ä¸ªé—®é¢˜çš„åˆ†æ,å¼„æ¸…æ¥šäº†Â <a class="reference external" href="http://puremvc.org/">pureMVC</a> æ ¸å¿ƒçš„notificationæœºåˆ¶çš„å‡ ä¸ª æ ¸å¿ƒé—®é¢˜,å¯¹äºåç»­çš„å·¥ä½œå’Œå­¦ä¹ éƒ½æ˜¯å¾ˆæœ‰ç›Šå¤„çš„.</div>
